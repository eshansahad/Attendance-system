{% extends "base.html" %}

{% block title %}
Teacher Dashboard
{% endblock %}

{% block header_title %}
Teacher Dashboard
{% endblock %}

{% block content %}

<!-- Welcome -->
<div class="welcome-banner">
    <div class="user-avatar orange">
        <i class="fas fa-user-graduate"></i>
    </div>
    <div class="welcome-text">
        <h3>Welcome Back, Teacher!</h3>
        <p>System is monitoring <strong>{{ intruders|length }}</strong> security alerts.</p>
    </div>
    <a href="/start_camera" class="btn btn-primary">
        <i class="fas fa-camera"></i> Start Attendance
    </a>
</div>

<!-- Stats -->
<div class="stats-grid">
    <div class="card">
        <h4>120</h4><span>Total Students</span>
    </div>
    <div class="card">
        <h4>{{ attendance|length }}</h4><span>Present Today</span>
    </div>
    <div class="card danger">
        <h4>{{ intruders|length }}</h4><span>Security Alerts</span>
    </div>
    <div class="card">
        <h4>95%</h4><span>Efficiency</span>
    </div>
</div>

<!-- Attendance Trend -->
<div class="table-card">
    <h3><i class="fas fa-chart-line"></i> Attendance Trend (Last 7 Days)</h3>
    <div id="attendanceChart" style="height:350px;"></div>
</div>

<!-- Attendance Table -->
<div class="table-card">
    <h3>Today's Attendance</h3>
    <table>
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Time In</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
        {% if attendance %}
            {% for row in attendance %}
            <tr>
                <td>{{ row[0] }}</td>
                <td>{{ row[2] }}</td>
                <td class="green">Present</td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="3" style="text-align:center;">No one present yet.</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>

<!-- Security Alerts -->
<div class="table-card alert">
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3><i class="fas fa-shield-alt"></i> Security Alerts</h3>
        {% if intruders %}
        <a href="/clear_intruders" class="btn btn-primary" style="background:#ef4444;">
            <i class="fas fa-trash"></i> Clear All
        </a>
        {% endif %}
    </div>

    {% if intruders %}
    <div class="security-grid">
        {% for intruder in intruders %}
        <div class="intruder-card">
            <img src="{{ url_for('serve_intruder', filename=intruder.filename) }}"alt="Intruder"style="width:100%; border-radius:10px;">
            <p>UNKNOWN</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="center green">No security threats detected.</p>
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script>
Highcharts.chart('attendanceChart', {
    chart: {
        type: 'spline',
        backgroundColor: 'transparent'
    },
    title: { text: null },
    xAxis: {
        categories: {{ chart_labels | safe }},
        labels: { style: { color: '#94a3b8' } }
    },
    yAxis: {
        title: { text: 'Attendance %' },
        max: 100
    },
    tooltip: { valueSuffix: '%' },
    series: [{
        name: 'Attendance',
        data: {{ chart_data | safe }},
        color: '#ff9b44'
    }],
    credits: { enabled: false }
});
</script>
{% endblock %}
