<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Smart Attend{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block extra_head %}{% endblock %}
</head>

<body>

<!-- ðŸŒˆ Background -->
<div class="rainbow-wrapper">
    {% for i in range(6) %}
        <div class="rainbow"></div>
    {% endfor %}
    <div class="h"></div>
    <div class="v"></div>
</div>

<!-- â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="sidebar">
    <div class="brand">
        <i class="fas fa-fingerprint"></i>
        <span>Smart</span>Attend
    </div>

    <ul class="menu">
    {% if session.role == 'teacher' %}
        <li><a href="/" class="{% if active_page=='dashboard' %}active{% endif %}">
            <i class="fas fa-th-large"></i> Dashboard</a></li>

        <li><a href="/students" class="{% if active_page=='students' %}active{% endif %}">
            <i class="fas fa-user-graduate"></i> Students</a></li>

        <li><a href="/register" class="{% if active_page=='register' %}active{% endif %}">
            <i class="fas fa-user-plus"></i> Register</a></li>

        <li><a href="/report" class="{% if active_page=='reports' %}active{% endif %}">
            <i class="fas fa-file-alt"></i> Reports</a></li>

        <li><a href="/settings" class="{% if active_page=='settings' %}active{% endif %}">
            <i class="fas fa-cog"></i> Settings</a></li>

        <li><a href="/complaints" class="{% if active_page=='complaints' %}active{% endif %}">
            <i class="fas fa-flag"></i> Complaints</a></li>

    {% elif session.role == 'student' %}
        <li><a href="/student_dashboard" class="{% if active_page=='student_home' %}active{% endif %}">
            <i class="fas fa-home"></i> My Dashboard</a></li>

        <li><a href="/complaint/new" class="{% if active_page=='complaints' %}active{% endif %}">
            <i class="fas fa-flag"></i> File Complaint</a></li>

        <li><a href="/complaint/my" class="{% if active_page=='my_complaints' %}active{% endif %}"
               style="position:relative;">
            <i class="fas fa-list"></i> My Complaints
            <span class="notif-badge" id="complaint-badge" style="display:none;"></span>
        </a></li>
    {% endif %}

    <li style="margin-top:auto;border-top:1px solid var(--glass-border);padding-top:8px;">
        <a href="/logout" style="color:#ef4444;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </li>
    </ul>
</div>

<!-- â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="main-content">

    <div class="header">
        <h2 style="margin:0;font-size:18px;">{% block header_title %}Dashboard{% endblock %}</h2>
        <div class="user-profile" style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:14px;color:var(--text-muted);">
                {{ session.user_name or ("Teacher" if session.role=="teacher" else "Student") }}
            </span>
            <div class="user-avatar"><i class="fas fa-user"></i></div>
        </div>
    </div>

    <div class="page-wrapper">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, msg in messages %}
                <div class="flash-msg flash-{{ category }}">
                    <i class="fas fa-info-circle"></i> {{ msg }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

</div>

{% block scripts %}{% endblock %}

<!-- â”€â”€ COMPLAINT BADGE (student only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if session.role == 'student' %}
<style>
.notif-badge {
    position: absolute;
    top: 10px;
    right: 14px;
    min-width: 18px;
    height: 18px;
    background: #ef4444;
    color: white;
    font-size: 10px;
    font-weight: 700;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 5px;
    box-shadow: 0 0 0 2px var(--bg-dark);
    animation: badgePop 0.3s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes badgePop {
    from { transform: scale(0); }
    to   { transform: scale(1); }
}
</style>
<script>
(function() {
    const badge = document.getElementById('complaint-badge');
    if (!badge) return;

    function pollBadge() {
        fetch('/complaint/badge')
            .then(r => r.json())
            .then(data => {
                if (data.count && data.count > 0) {
                    badge.textContent = data.count;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            })
            .catch(() => {});
    }

    // Run immediately, then every 10 seconds
    pollBadge();
    setInterval(pollBadge, 10000);
})();
</script>
{% endif %}

</body>
</html>