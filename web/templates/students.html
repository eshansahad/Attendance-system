{% extends "base.html" %}

{% block title %}Students{% endblock %}
{% block header_title %}Students{% endblock %}

{% block content %}

<div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:24px;">
    <a href="/register" class="btn btn-primary">
        <i class="fas fa-user-plus"></i> Register New Student
    </a>
    <a href="/bulk_import" class="btn btn-primary"
       style="background:rgba(255,255,255,0.08);">
        <i class="fas fa-file-csv"></i> Bulk Import CSV
    </a>
</div>

<div class="table-card">
    <h3><i class="fas fa-user-graduate"></i> All Students ({{ students|length }})</h3>

    {% if students %}
    <div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Attendance</th>
                <th>Present</th>
                <th>Late</th>
                <th>Absent</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for s in students %}
        <tr {% if s.below_threshold %}style="border-left:3px solid #ef4444;"{% endif %}>
            <td class="muted-text">{{ loop.index }}</td>
            <td>
                {{ s.name }}
                {% if s.below_threshold %}
                    <span class="override-tag" style="background:rgba(239,68,68,0.15);color:#ef4444;">
                        <i class="fas fa-exclamation-triangle"></i> at risk
                    </span>
                {% endif %}
            </td>
            <td>
                <div style="display:flex;align-items:center;gap:10px;">
                    <div class="progress-bar" style="width:90px;flex-shrink:0;">
                        <div class="progress-fill"
                             style="width:{{ s.percentage }}%;
                                    background:{% if s.below_threshold %}
                                        linear-gradient(90deg,#ef4444,#f97316)
                                    {% else %}
                                        linear-gradient(90deg,#10b981,#03a9f4)
                                    {% endif %};">
                        </div>
                    </div>
                    <span style="font-weight:600;
                                 color:{% if s.below_threshold %}#ef4444{% else %}#10b981{% endif %};">
                        {{ s.percentage }}%
                    </span>
                </div>
            </td>
            <td><span style="color:#10b981;">{{ s.present }}</span></td>
            <td><span style="color:#f59e0b;">{{ s.late }}</span></td>
            <td><span style="color:#ef4444;">{{ s.absent }}</span></td>
            <td>
                <a href="/delete_student/{{ s.id }}"
                   onclick="return confirm('Delete {{ s.name }} and all their records?')"
                   class="btn btn-primary"
                   style="padding:6px 14px;font-size:12px;background:#ef4444;">
                    <i class="fas fa-trash"></i> Delete
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-user-graduate"></i>
        <span>No students registered yet.</span>
        <a href="/register" class="btn btn-primary" style="margin-top:14px;">
            <i class="fas fa-user-plus"></i> Register First Student
        </a>
    </div>
    {% endif %}
</div>

{% endblock %}